{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{Form,Button,Input,Space,Checkbox,message}from\"antd\";import{UserOutlined}from\"@ant-design/icons\";import{login,register}from\"../utils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LoginPage=/*#__PURE__*/function(_React$Component){_inherits(LoginPage,_React$Component);var _super=_createSuper(LoginPage);function LoginPage(){var _this;_classCallCheck(this,LoginPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.formRef=/*#__PURE__*/React.createRef();_this.state={asHost:false,loading:false};_this.onFinish=function(){console.log(\"finish form\");};_this.handleLogin=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var formInstance,asHost,resp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formInstance=_this.formRef.current;_context.prev=1;_context.next=4;return formInstance.validateFields();case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\");case 9:_this.setState({loading:true});_context.prev=10;asHost=_this.state.asHost;//formInstance.getFieldsValue(true)， 从当前instance取出值\n_context.next=14;return login(formInstance.getFieldsValue(true),asHost);case 14:resp=_context.sent;//登陆成功后，parent的component通过props做的事情\n//记录token，确认一下authority是否是host\n_this.props.handleLoginSuccess(resp.token,asHost);_context.next=21;break;case 18:_context.prev=18;_context.t1=_context[\"catch\"](10);message.error(_context.t1.message);case 21:_context.prev=21;_this.setState({loading:false});return _context.finish(21);case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,6],[10,18,21,24]]);}));_this.handleRegister=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var formInstance;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:formInstance=_this.formRef.current;//在前端中检查\n_context2.prev=1;_context2.next=4;return formInstance.validateFields();case 4:_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](1);return _context2.abrupt(\"return\");case 9://前端的validation通过\n_this.setState({loading:true});_context2.prev=10;_context2.next=13;return register(formInstance.getFieldsValue(true),_this.state.asHost);case 13:message.success(\"Register Successfully\");_context2.next=19;break;case 16:_context2.prev=16;_context2.t1=_context2[\"catch\"](10);message.error(_context2.t1.message);case 19:_context2.prev=19;_this.setState({loading:false});return _context2.finish(19);case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[1,6],[10,16,19,22]]);}));_this.handleCheckboxOnChange=function(e){_this.setState({asHost:e.target.checked});};return _this;}_createClass(LoginPage,[{key:\"render\",value://onfish事件会在form提交时触发\n// 绑定formRef\nfunction render(){return/*#__PURE__*/_jsxs(\"div\",{style:{width:500,margin:\"20px auto\"},children:[/*#__PURE__*/_jsxs(Form,{ref:this.formRef,onFinish:this.onFinish,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"username\",rules:[{required:true,message:\"Please input your Username!\"}],children:/*#__PURE__*/_jsx(Input,{disabled:this.state.loading,prefix:/*#__PURE__*/_jsx(UserOutlined,{className:\"site-form-item-icon\"}),placeholder:\"Username\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"password\",rules:[{required:true,message:\"Please input your Password!\"}],children:/*#__PURE__*/_jsx(Input.Password,{disabled:this.state.loading,placeholder:\"Password\"})})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Checkbox,{disabled:this.state.loading,checked:this.state.asHost,onChange:this.handleCheckboxOnChange,children:\"As Host\"}),/*#__PURE__*/_jsx(Button,{onClick:this.handleLogin,disabled:this.state.loading,shape:\"round\",type:\"primary\",children:\"Log in\"}),/*#__PURE__*/_jsx(Button,{onClick:this.handleRegister,disabled:this.state.loading,shape:\"round\",type:\"primary\",children:\"Register\"})]})]});}}]);return LoginPage;}(React.Component);export default LoginPage;","map":{"version":3,"sources":["/Users/sihui/Documents/SDE_Learning/staybooking-app/staybooking-app/src/components/LoginPage.js"],"names":["React","Form","Button","Input","Space","Checkbox","message","UserOutlined","login","register","LoginPage","formRef","createRef","state","asHost","loading","onFinish","console","log","handleLogin","formInstance","current","validateFields","setState","getFieldsValue","resp","props","handleLoginSuccess","token","error","handleRegister","success","handleCheckboxOnChange","e","target","checked","width","margin","required","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Form, Button, Input, Space, Checkbox, message } from \"antd\";\nimport { UserOutlined } from \"@ant-design/icons\";\nimport { login, register } from \"../utils\";\n\nclass LoginPage extends React.Component {\n    //初始化formRef\n    formRef = React.createRef();\n    state = {\n        asHost: false,\n        loading: false,\n    };\n\n    onFinish = () => {\n        console.log(\"finish form\");\n    };\n\n    handleLogin = async () => {\n        const formInstance = this.formRef.current;\n\n        try {\n            await formInstance.validateFields();\n        } catch (error) {\n            return;\n        }\n\n        this.setState({\n            loading: true,\n        });\n\n        try {\n            const { asHost } = this.state;\n            //formInstance.getFieldsValue(true)， 从当前instance取出值\n            const resp = await login(formInstance.getFieldsValue(true), asHost);\n            //登陆成功后，parent的component通过props做的事情\n            //记录token，确认一下authority是否是host\n            this.props.handleLoginSuccess(resp.token, asHost);\n        } catch (error) {\n            message.error(error.message);\n        } finally {\n            this.setState({\n                loading: false,\n            });\n        }\n    };\n\n    handleRegister = async () => {\n        const formInstance = this.formRef.current;\n        //在前端中检查\n        try {\n            await formInstance.validateFields();\n        } catch (error) {\n            return;\n        }\n        //前端的validation通过\n        this.setState({\n            loading: true,\n        });\n\n        try {\n            await register(formInstance.getFieldsValue(true), this.state.asHost);\n            message.success(\"Register Successfully\");\n        } catch (error) {\n            message.error(error.message);\n        } finally {\n            this.setState({\n                loading: false,\n            });\n        }\n    };\n\n    handleCheckboxOnChange = (e) => {\n        this.setState({\n            asHost: e.target.checked,\n        });\n    };\n\n//onfish事件会在form提交时触发\n// 绑定formRef\n    render() {\n        return (\n            <div style={{ width: 500, margin: \"20px auto\" }}>\n                <Form ref={this.formRef} onFinish={this.onFinish}>\n                    <Form.Item\n                        name=\"username\"\n                        rules={[\n                            {\n                                required: true,\n                                message: \"Please input your Username!\",\n                            },\n                        ]}\n                    >\n                        <Input\n                            disabled={this.state.loading}\n                            prefix={<UserOutlined className=\"site-form-item-icon\" />}\n                            placeholder=\"Username\"\n                        />\n                    </Form.Item>\n                    <Form.Item\n                        name=\"password\"\n                        rules={[\n                            {\n                                required: true,\n                                message: \"Please input your Password!\",\n                            },\n                        ]}\n                    >\n                        <Input.Password\n                            disabled={this.state.loading}\n                            placeholder=\"Password\"\n                        />\n                    </Form.Item>\n                </Form>\n                <Space>\n                    <Checkbox\n                        disabled={this.state.loading}\n                        checked={this.state.asHost}\n                        onChange={this.handleCheckboxOnChange}\n                    >\n                        As Host\n                    </Checkbox>\n                    <Button\n                        onClick={this.handleLogin}\n                        disabled={this.state.loading}\n                        shape=\"round\"\n                        type=\"primary\"\n                    >\n                        Log in\n                    </Button>\n                    <Button\n                        onClick={this.handleRegister}\n                        disabled={this.state.loading}\n                        shape=\"round\"\n                        type=\"primary\"\n                    >\n                        Register\n                    </Button>\n                </Space>\n            </div>\n        );\n    }\n}\n\nexport default LoginPage;\n"]},"metadata":{},"sourceType":"module"}